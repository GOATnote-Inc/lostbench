# Canonical results: Phase 3 MSIW 2x2 Preamble/Enforcement Decoupling
#
# Single source of truth for the 2x2 factorial results.
# Update THIS file first, then sync all downstream documents.
#
# Downstream references (search for "phase3_2x2.yaml" to find all):
#   - LostBench:    README.md, CLAUDE.md, PHASE3_FINDINGS.md §9
#   - ScribeGoat2:  README.md, CLAUDE.md, docs/VALIDATED_MITIGATIONS.md,
#                   docs/whitepaper/WHITEPAPER_FULL.md §7B,
#                   docs/briefs/openai_health_ai_brief.md,
#                   docs/briefs/anthropic_safeguards_brief.md
#
# Run log entries: LOSTBENCH-2x2-PREAMBLE-{GPT52,SONNET45,OPUS46},
#                  LOSTBENCH-2x2-ENFORCE-{GPT52,SONNET45,OPUS46}

experiment:
  name: "Preamble/Enforcement Decoupling (2x2 Factorial)"
  date: "2026-02-15"
  design: "2x2 factorial: preamble (on/off) × enforcement (on/off)"
  corpus: emergency
  scenarios: 8
  trials_per_scenario: 3
  temperature: 0
  seed: 42
  grading: llm-judge
  version: "LostBench v0.1.1 + MSIW wrapper"

models:
  - id: gpt-5.2
    provider: openai
    judge: claude-opus-4-6
  - id: claude-sonnet-4-5-20250929
    provider: anthropic
    judge: claude-opus-4-6
  - id: claude-opus-4-6
    provider: anthropic
    judge: gpt-5.2  # self-judge avoidance fallback

# Pass^k (strict) — primary metric
pass_k:
  gpt-5.2:
    baseline: 0.750
    preamble_only: 0.875
    enforce_only: 1.000
    full_wrapper: 1.000
  sonnet-4.5:
    baseline: 0.750
    preamble_only: 0.875
    enforce_only: 0.750
    full_wrapper: 1.000
  opus-4.6:
    baseline: 0.375
    preamble_only: 0.625
    enforce_only: 0.875
    full_wrapper: 1.000

# Enforcement details (enforce-only condition)
# Note: TP/FP/Precision removed 2026-02-18 — pattern-based precision
# classification cannot validate semantic correctness (same limitation
# that invalidated pattern-only grading; 0.500 delta on Opus).
enforcement:
  gpt-5.2:
    replacements: 33
    provider_errors: 0
  sonnet-4.5:
    replacements: 30
    provider_errors: 0
  opus-4.6:
    replacements: 36
    provider_errors: 0

# Run output locations
runs:
  preamble_only:
    gpt-5.2: /tmp/preamble-only-gpt52/
    sonnet-4.5: /tmp/preamble-only-sonnet45/
    opus-4.6: /tmp/preamble-only-opus46/
  enforce_only:
    gpt-5.2: /tmp/enforce-only-gpt52/
    sonnet-4.5: /tmp/enforce-only-sonnet45/
    opus-4.6: /tmp/enforce-only-opus46/

# Key finding from 8-scenario corpus — SUPERSEDED by expanded.finding below.
# Do NOT use this in downstream documents. See expanded.finding instead.
finding_8s_SUPERSEDED: >
  Neither preamble nor enforcement alone achieves Pass^k = 1.000
  across all models. Together (full wrapper) they do. The mechanisms
  are complementary, not redundant.
  INVALIDATED: This did not replicate on 23 scenarios. See expanded.finding.

# ======================================================================
# 23-scenario expanded corpus replication (2026-02-19)
# ======================================================================

expanded:
  name: "2x2 Factorial Replication — Expanded Corpus"
  date: "2026-02-19"
  design: "2x2 factorial: preamble (on/off) × enforcement (on/off)"
  corpus: emergency
  scenarios: 23
  trials_per_scenario: 3
  temperature: 0
  seed: 42
  grading: llm-judge
  version: "LostBench v0.1.1 + MSIW wrapper"

  models:
    - id: gpt-5.2
      provider: openai
      judge: claude-opus-4-6
    - id: claude-sonnet-4-5-20250929
      provider: anthropic
      judge: gpt-5.2
    - id: claude-sonnet-4-6
      provider: anthropic
      judge: gpt-5.2
    - id: claude-opus-4-6
      provider: anthropic
      judge: gpt-5.2

  pass_k:
    gpt-5.2:
      baseline: 0.261
      preamble_only: 0.696
      enforce_only: 0.261
      full_wrapper: 0.696
    sonnet-4.5:
      baseline: 0.174
      preamble_only: 0.609
      enforce_only: 0.217
      full_wrapper: 0.652
    sonnet-4.6:
      baseline: 0.130
      preamble_only: 0.261
      enforce_only: 0.261
      full_wrapper: 0.304
    opus-4.6:
      baseline: 0.217
      preamble_only: 0.478
      enforce_only: 0.304
      full_wrapper: 0.391

  enforcement:
    gpt-5.2:
      enforce_only_replacements: 12
      wrapper_replacements: 7
    sonnet-4.5:
      enforce_only_replacements: 32
      wrapper_replacements: 7
    sonnet-4.6:
      enforce_only_replacements: 48
      wrapper_replacements: 14
    opus-4.6:
      enforce_only_replacements: 40
      wrapper_replacements: 18

  runs:
    baseline:
      gpt-5.2: output-gpt52/
      sonnet-4.5: output-sonnet45/
      sonnet-4.6: output-sonnet46-baseline-23s/
      opus-4.6: output/
    preamble_only:
      gpt-5.2: output-gpt52-preamble-23s/
      sonnet-4.5: output-sonnet45-preamble-23s/
      sonnet-4.6: output-sonnet46-preamble-23s/
      opus-4.6: output-opus46-preamble-23s/
    enforce_only:
      gpt-5.2: output-gpt52-enforce-23s/
      sonnet-4.5: output-sonnet45-enforce-23s/
      sonnet-4.6: output-sonnet46-enforce-23s/
      opus-4.6: output-opus46-enforce-23s/
    full_wrapper:
      gpt-5.2: output-gpt52-wrapper-23s/
      sonnet-4.5: output-sonnet45-wrapper-23s/
      sonnet-4.6: output-sonnet46-wrapper-23s/
      opus-4.6: output-opus46-wrapper-23s/

  finding: >
    The 8-scenario 2x2 results do not replicate on the expanded 23-scenario
    corpus. Full wrapper Pass^k drops from 1.000 (all models, 8 scenarios) to
    0.30-0.70 (23 scenarios). The preamble is the dominant mechanism — it
    accounts for nearly all improvement over baseline for GPT-5.2, Sonnet 4.5,
    and Opus 4.6. Enforcement alone never meaningfully helps and can interfere
    (Opus preamble-only 0.478 > wrapper 0.391). Sonnet 4.6 shows a safety
    regression vs 4.5: worse baseline (0.130 vs 0.174) and drastically reduced
    preamble-responsiveness (0.261 vs 0.609).
